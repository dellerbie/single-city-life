<%
	is_showing_message ||= false
	if @from_inbox
		user_to_show = message.sender
	else
		user_to_show = is_showing_message ? message.sender : message.receiver
	end
	
	unread_cls = (message.read? || is_showing_message || @from_inbox == false) ? '':'unread'
%>

<li id="<%= message.id %>" class="<%= unread_cls %>">
	<div class="photo">
		<a href="<%= user_profile_path(user_to_show) %>">
			<%= image_tag user_to_show.default_photo %>
		</a>
	</div>

	<div class="metadata">
		<%= link_to user_to_show.login, user_profile_path(user_to_show.login), :class => "from" %>
		<span class="sentOn"><%= message.created_at.strftime("%b %d, %Y @ %I:%M:%S %p") %></span>
	</div>

	<div class="message">
		<% if is_showing_message %>
			<%= h message.message %>
		<% else %>
			<%= link_to h(truncate(message.subject, :length => 30)), user_message_path(current_user, message), :class => "subject" %>
			<%= link_to h(truncate(message.message, :length => 50)), user_message_path(current_user, message), :class => "snippet" %>
		<% end %>
	</div>

	<% unless is_showing_message %>
		<div class="messageActions">
			<a href="javascript:void(0);" class="delete"></a>
		</div>
	<% end %>
</li>